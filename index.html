<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>areamap</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="row">
            <!-- <div class="col-12"> -->
            <div class="col-6">
                <div id="view">

                </div>
                <img src="img/Krusty_Le_Clown.webp" id="img" alt="Workplace" usemap="#workmap" width="400" height="500">
                <map name="workmap" id="mapArea">
                </map>
            </div>
            <div class="form col-6">
                <div class="container">
                    <form class="map" id="map" class="col-12">
                        <!--  formulaire ajouter une map -->
                        <div class="row">
                            <label for="nom" class="col-6">Nom de la map</label>
                            <input id="nom" class="col-6" type="text" name="nom" onchange="changeName();"
                                placeholder="Map" />
                            <label for="id" class="col-6">Id de l'aire</label>
                            <input id="id" class="col-6" type="text" name="id" value="0" placeholder="Id" />
                            <label for="action" class="col-6">Action</label>
                            <input id="action" class="col-6" type="text" name="action" />
                            <label for="type" class="col-6">Type d'aire</label>
                            <select name="type" class="col-6" id="type">
                                <option value="0">Carré</option>
                                <option value="1">Rectangle</option>
                                <option value="2">Cercle</option>
                                <option value="3">Polygone</option>
                            </select>
                            <!-- <input type="submit" class="btn btn-primary col align-self-end" name="login-form-submit"
                                value="Ajouter" /> -->
                        </div>
                    </form>
                    <div class="row">
                        <div class="col-12">
                            <!--  flèche -->
                            <div class="row justify-content-center">
                                <button class="btn col-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-arrow-up">
                                        <line x1="12" y1="19" x2="12" y2="5"></line>
                                        <polyline points="5 12 12 5 19 12"></polyline>
                                    </svg>
                                </button>
                            </div>
                            <div class="col-12">
                                <div class="row justify-content-between">
                                    <button class="btn col-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round"
                                            class="feather feather-arrow-left">
                                            <line x1="19" y1="12" x2="5" y2="12"></line>
                                            <polyline points="12 19 5 12 12 5"></polyline>
                                        </svg>
                                    </button>
                                    <button class="btn col-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round"
                                            class="feather feather-arrow-right">
                                            <line x1="5" y1="12" x2="19" y2="12"></line>
                                            <polyline points="12 5 19 12 12 19"></polyline>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="row justify-content-center">
                                <button class="btn col-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="feather feather-arrow-down">
                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                        <polyline points="19 12 12 19 5 12"></polyline>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <!--  formulaire modifier les points -->
                            <form class="points" class="col-12">
                                <div class="col-size">
                                    <div class="col-12">
                                        <h3>Point 1:</h3>
                                    </div>
                                    <div class="col-12">
                                        <label for="x">X :</label>
                                        <input id="x1" type="text" name="x" placeholder="x" />
                                        <label for="y">Y :</label>
                                        <input id="y1" type="text" name="y" placeholder="y" />
                                    </div>
                                    <div class="col-12">
                                        <h3>Point 2:</h3>
                                    </div>
                                    <div class="col-12">
                                        <label for="x">X :</label>
                                        <input id="x2" type="text" name="x" placeholder="x" />
                                        <label for="y">Y :</label>
                                        <input id="y2" type="text" name="y" placeholder="y" />
                                    </div>
                                </div>
                                <div class="row" style="margin-top: 20px;">
                                    <button type="submit" class="btn btn-primary col-6" name="login-form-submit"
                                        onclick="update(event)">Modifier</button>
                                    <button type="submit" class="btn btn-primary col-6" name="login-form-submit"
                                        onclick="creerArea(event)">Créer</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-2">
                <button type="submit" id="afficher" class="btn btn-primary" name="login-form-submit"
                    onclick="viewPos(event)">Afficher</button>
            </div>
            <!-- </div> -->
        </div>
    </div>
</body>
<script>
    class Map {
        chemingImage;
        nomMap;
        tblObjetAreaCarre;
        constructor(chemingImage, nomMap, tblObjetAreaCarre) {
            this.chemingImage = chemingImage;
            this.nomMap = nomMap;
            this.tblObjetAreaCarre = tblObjetAreaCarre;
        }
        setTblObjetAreaCarre() {
            return this.tblObjetAreaCarre;
        }
        getNomMape() {
            return this.nomMap;
        }
        setNomMape(nom) {
            this.nomMap = nom;
        }
        getChemingImage() {
            return this.chemingImage;
        }
        addElementArrayAreaCarre(element) {
            this.tblObjetAreaCarre.push(element);
        }
        getAreaCarreById(id) {
            var back = false;
            this.tblObjetAreaCarre.forEach(element => {
                if (element.getId() == id) {
                    back = element;
                }
            });
            return back;
        }
    }
    class AreaCarre {
        id;
        typeAire;
        tblObjetPoint;
        constructor(id, typeAire, tblObjetPoint) {
            this.id = id;
            this.typeAire = typeAire;
            this.tblObjetPoint = tblObjetPoint;
        }
        getCoordonnees() {
            return this.tblObjetPoint;
        }
        setCoordonnees(integer, number) {
            this.tblObjetPoint[number] = integer;
        }
        testAfficheObjetDansConsole() {
            console.log(this);
        }
        getId() {
            return this.id;
        }
    }
    class Point {
        x;
        y;
        constructor(x, y) {
            this.x = x;
            this.y = y;
        }
        getCoordonnees() {
            return x + "|" + y;
        }
        setX(x) {
            this.x = x;
        }
        setY(y) {
            this.y = y;
        }
        getX() {
            return this.x;
        }
        getY() {
            return this.y;
        }
        testAfficheObjetDansConsole() {
            console.log(this);
        }
    }

    var map = new Map("img/Krusty_Le_Clown.webp", 'map de Krusty Le Clown', []);// map créé en dur


    $(document).ready(function () {
        // document.getElementById("img").src = map.getChemingImage();
        document.getElementById("nom").value = map.getNomMape();
    });

    function creerArea(e) {
        e.preventDefault();
        var myForm = document.getElementById('map');
        formData = new FormData(myForm);
        creer = true;
        if (isNaN(formData.get('id'))) {
            alert("id est faux !!");
            creer = false;
        }
        map.setTblObjetAreaCarre().forEach(element => {
            if (element.id == formData.get('id')) {
                alert("id déjà utilisé !!");
                creer = false;
            }
        });
        if (creer) {

            var point1 = new Point(formData.get('id'), formData.get('id'));
            var point2 = new Point(50, 50);
            tblPoint = [
                point1,
                point2
            ];
            var areaCarre = new AreaCarre(formData.get('id'), formData.get('type'), tblPoint);
            map.addElementArrayAreaCarre(areaCarre);
            var parsed = parseInt(document.getElementById("id").value);
            // document.getElementById("id").value = parsed + 1;
            printPos(areaCarre);
            returnPointForm(areaCarre);
            console.log(map.setTblObjetAreaCarre());

        }
    }

    function printPos(areaCarre) {
        if (document.getElementById(areaCarre.getId()) != null) {
            document.getElementById(areaCarre.getId()).remove();
        }
        var element = document.getElementById("mapArea").innerHTML;
        document.getElementById("mapArea").innerHTML = "<area shape='rect' id="
            + areaCarre.getId() + " title='Yellow' 'https://mozilla.org' coords='"
            + areaCarre.getCoordonnees()[0].getX() + ","
            + areaCarre.getCoordonnees()[0].getY() + ","
            + (parseInt(areaCarre.getCoordonnees()[1].getX())) + ","
            + (parseInt(areaCarre.getCoordonnees()[1].getY())) + "' alt='Computer' href='computer.htm'>" + element;
    }

    function update(e) {
        e.preventDefault();
        areaCarre = map.getAreaCarreById(document.getElementById("id").value);
        areaCarre.getCoordonnees()[0].setX(document.getElementById("x1").value);
        areaCarre.getCoordonnees()[0].setY(document.getElementById("y1").value);
        areaCarre.getCoordonnees()[1].setX(document.getElementById("x2").value);
        areaCarre.getCoordonnees()[1].setY(document.getElementById("y2").value);
        printPos(areaCarre);
        if (document.getElementById("afficher").innerHTML == "Cacher") {
            document.getElementById("afficher").innerHTML = "Afficher";
        } else {
            document.getElementById("afficher").innerHTML = "Cacher";
        }
        viewPos(e);
    }

    function viewPos(e) {
        e.preventDefault();
        document.getElementById("view").innerHTML = "";
        if (document.getElementById("afficher").innerHTML == "Cacher") {
            document.getElementById("afficher").innerHTML = "Afficher";
        } else {
            document.getElementById("afficher").innerHTML = "Cacher";
            var total = [];
            map.setTblObjetAreaCarre().forEach(element => {
                var cor = [];
                cor.push(element.getId());
                element.getCoordonnees().forEach(elementNext => {
                    cor.push(elementNext.getX());
                    cor.push(elementNext.getY());
                });
                total.push(cor);
            });
            console.log(total);
            total.forEach(element => {
                var c = document.getElementById("view").innerHTML;
                var x1 = parseInt(element[1]);
                var y1 = parseInt(element[2]);
                var x2 = parseInt(element[3]);
                var y2 = parseInt(element[4]);
                if (x1 < x2 && y1 < y2) {
                    x1 = element[1];
                    y1 = element[2];
                    x2 = (parseInt(element[3]) - parseInt(element[1]));
                    y2 = (parseInt(element[4]) - parseInt(element[2]));
                }
                else if (x1 > x2 && y1 > y2) {
                    x1 = element[3];
                    y1 = element[4];
                    x2 = (parseInt(element[1]) - parseInt(element[3]));
                    y2 = (parseInt(element[2]) - parseInt(element[4]));
                }
                else if (x1 < x2 && y1 > y2) {
                    x1 = element[1];
                    y1 = element[4];
                    x2 = (parseInt(element[3]) - parseInt(element[1]));
                    y2 = (parseInt(element[2]) - parseInt(element[4]));
                }
                else if (x1 > x2 && y1 < y2) {
                    x1 = element[3];
                    y1 = element[2];
                    x2 = (parseInt(element[1]) - parseInt(element[3]));
                    y2 = (parseInt(element[4]) - parseInt(element[2]));
                } else if (x1 == x2 && y1 == y2) {
                    x1 = element[3];
                    y1 = element[2];
                    x2 = (parseInt(element[1]) - parseInt(element[3]));
                    y2 = (parseInt(element[4]) - parseInt(element[2]));
                }



                document.getElementById("view").innerHTML = "<div id='view"
                    + element[0] +
                    "' style='border: solid; left: " + x1 + //x(1)
                    "px; top: " + y1 + //y(1)
                    "px; width: " + x2 +  //x(2)
                    "px; height: " + y2 + //y(2)
                    "px; position: absolute;'></div>" + c;
            });
        }
    }

    function returnPointForm(areaCarre) {
        document.getElementById("x1").value = areaCarre.getCoordonnees()[0].getX();
        document.getElementById("y1").value = areaCarre.getCoordonnees()[0].getY();
        document.getElementById("x2").value = areaCarre.getCoordonnees()[1].getX();
        document.getElementById("y2").value = areaCarre.getCoordonnees()[1].getY();
    }
    function changeName() {
        map.setNomMape(document.getElementById("nom").value);
        console.log(map.getNomMape());
    }
</script>

</html>